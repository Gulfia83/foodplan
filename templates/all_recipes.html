{% extends 'base.html' %}
{% load static %}
{% block title %}–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é, –º–µ–Ω—é, —Ä–µ—Ü–µ–ø—Ç—ã, —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é, –±–µ–∑—É–≥–ª–µ–≤–æ–¥–Ω–æ–µ –º–µ–Ω—é{% endblock %}
{% block content %}
  <center>
    <h2>{{ title }}</h2>
  </center>

  <div class="container">
    <table class="table table-responsive">
      {% for dish in dishes %}
          <tr>
              <td><img src="{{ dish.img.url }}" alt="" style="width: 200px; height: 130px;"></td>
              <td><a href="{% url 'recipe' dish.id %}" class="title">{{ dish.title }}</a></td>
              <td>
                  {% for item in dish.items.all %}
                      {{ item.ingredient.title }} - {{ item.quantity }}{{item.ingredient.units}},
                  {% endfor %}
              </td>
              <td>{{ dish.price }} —Ä—É–±.</td>
              <td>
                <form class="like-form" action="{% url 'accounts:like' dish.id %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="like-button {% if user.is_authenticated and dish.id in liked_dishes %}liked{% endif %}" data-dish-id="{{ dish.id }}">
                    ü§ç
                  </button>
                </form>
                <div id="like-status-{{ dish.id }}"></div>
              </td>
          </tr>
      {% endfor %}
  </table>
  </div>

  <script>
    document.querySelectorAll('.like-form').forEach(function(form) {
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
    
            const formData = new FormData(form); // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    
            fetch(form.action, {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                const button = form.querySelector('.like-button');
                const dishId = button.getAttribute('data-dish-id');
                const statusDiv = document.getElementById('like-status-' + dishId);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∏ –∫–ª–∞—Å—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –ª–∞–π–∫–∞
                if (data.liked) {
                    button.classList.add('liked'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ª–∞–π–∫–∞
                    button.textContent = '‚ù§Ô∏è'; // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ
                    statusDiv.textContent = '–í—ã –ª–∞–π–∫–Ω—É–ª–∏ —ç—Ç–æ –±–ª—é–¥–æ!'; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ
                } else {
                    button.classList.remove('liked'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è –ª–∞–π–∫–∞
                    button.textContent = 'ü§ç'; // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –ø—É—Å—Ç–æ–µ —Å–µ—Ä–¥–µ—á–∫–æ
                    statusDiv.textContent = '–í—ã —É–±—Ä–∞–ª–∏ –ª–∞–π–∫ —Å —ç—Ç–æ–≥–æ –±–ª—é–¥–∞.'; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
        });
    });
</script>
{% endblock %}