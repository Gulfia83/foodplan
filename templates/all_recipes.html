{% extends 'base.html' %}
{% load static %}
{% block title %}План питания на неделю, меню, рецепты, список покупок. Классическое меню, безуглеводное меню{% endblock %}
{% block content %}
  <center>
    <h2>{{ title }}</h2>
  </center>
  <div class="container">
    <table class="table table-responsive">
      {% for recipe in recipes %}
        <tr>
          <td><img src="{{recipe.img.url}}" alt="" style="width: 200px; height: 130px;"></td>
          <td><a href="{% url 'recipe' recipe.id %}" class="title">{{recipe.title}}</a></td>
          <td>
            {% for item in recipe.items.all %}
            {{item.ingredient.title}} - {{ item.quantity }},
            {% endfor %}
          </td>
          <td>{{ recipe.price }} руб.</td>
          <td>
            <form action="{% url 'accounts:like' recipe.id %}" method="post" class="like-form">
                {% csrf_token %}
                <button type="submit">Лайк</button>
            </form>
            <div id="like-status-{{ dish.id }}"></div>
          </td>
        </tr>
      {% endfor %}
    </table>    
  </div>

<script>
  document.querySelectorAll('.like-form').forEach(function(form) {
      form.addEventListener('submit', function(event) {
          event.preventDefault(); // Предотвращаем стандартное поведение формы
  
          const formData = new FormData(form);
          const dishId = form.querySelector('button').getAttribute('data-dish-id');
  
          fetch(form.action, {
              method: 'POST',
              body: formData,
          })
          .then(response => response.json())
          .then(data => {
              const statusDiv = document.getElementById('like-status-' + dishId);
              statusDiv.textContent = data.message; // Показываем сообщение о статусе лайка
          })
          .catch(error => console.error('Ошибка:', error));
      });
  });
</script>
{% endblock %}